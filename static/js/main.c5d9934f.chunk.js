(this.webpackJsonpcreatures=this.webpackJsonpcreatures||[]).push([[0],{134:function(t,e,n){"use strict";n.r(e);var a=n(0),i=n.n(a),r=n(27),o=n.n(r),c=(n(76),n(7)),s=n.n(c),u=n(21),l=n(8),f=n(152),y=n(153),m=n(148),d=n(14),v=n.n(d),p=function(t){var e=t.iterations,n=t.foodAvailability,a=t.setIterations,r=t.setFoodAvailability,o=t.onStart;return i.a.createElement("div",{className:v.a.settingsContainer},i.a.createElement(m.a,{variant:"h3",component:"h1"},"Simulation Settings"),i.a.createElement("div",{className:v.a.settingsInnerBox},i.a.createElement("div",{className:v.a.settingSection},i.a.createElement(m.a,{id:"discrete-slider-small-steps",gutterBottom:!0},"Iterations"),i.a.createElement(y.a,{value:e,"aria-labelledby":"discrete-slider-small-steps",step:5,marks:!0,min:5,max:100,valueLabelDisplay:"auto",onChange:function(t,e){return a(e)}})),i.a.createElement("div",{className:v.a.settingSection},i.a.createElement(m.a,{id:"discrete-slider-small-steps",gutterBottom:!0},"Food Availability"),i.a.createElement(y.a,{value:n,"aria-labelledby":"discrete-slider-small-steps",step:25,marks:!0,min:50,max:400,valueLabelDisplay:"auto",onChange:function(t,e){return r(e)}})),i.a.createElement(f.a,{variant:"contained",color:"primary",onClick:o},"Start")))},h=n(149),b=n(151),g=n(20),x=n.n(g),w=n(37),j=n.n(w),E=n(44),A=n.n(E),O=n(23),C=2*Math.PI/5,I=n(30),R=n(38),M="SIGMOID",S="IDENTITY",T=function t(e,n){var a=e.weights,i=e.layersStructure;if(i.length<2)throw new Error("Network must have at least 2 layers");var r=(i[0].size+1)*i[1].size,o=a.slice(0,r),c=A()(o,i[0].size+1).map((function(t){var e=j()(t,[].concat(Object(O.a)(n),[1])).map((function(t){var e=Object(l.a)(t,2);return e[0]*e[1]})).reduce((function(t,e){return t+e}),0);return function(t,e){var n;return(n={},Object(R.a)(n,M,(function(t){return 2/(1+Math.exp(-t))-1})),Object(R.a)(n,S,(function(t){return t})),n)[t](e)}(i[1].activateFunction,e)}));return 2===i.length?c:t(Object(I.a)({},e,{weights:a.slice(r),layersStructure:i.slice(1)}),c)},F=function(t){var e=t.weights,n=t.foodAvailability,a=new Array(n).fill(null).map((function(){return{type:"FOOD",x:1e3*Math.random(),y:600*Math.random()}})),i={type:"CREATURE",x:500,y:300,heading:0,visibilityAngle:C,visibilityRange:100,brain:{weights:e,layersStructure:[{size:3,activateFunction:M},{size:5,activateFunction:M},{size:1,activateFunction:M}]},tummyContent:0};return{objects:[].concat(Object(O.a)(a),[i])}},P=function(t){return t>Math.PI?t-2*Math.PI:t<-Math.PI?t+2*Math.PI:t},k=function(t,e){var n=t.x-e.x,a=t.y-e.y,i=Math.abs(n),r=Math.abs(a);return n<0&&a>=0?-Math.PI+Math.atan(i/r):n<0&&a<0?-Math.atan(i/r):n>=0&&a<0?Math.atan(i/r):n>=0&&a>=0?Math.PI-Math.atan(i/r):void 0},_=function(t,e,n){var a=function(t,e){var n=e.filter((function(t){return"FOOD"===t.type})).filter((function(e){var n=e.x,a=e.y;return Math.hypot(n-t.x,a-t.y)<100})).map((function(e){return{angle:P(k(e,t)-t.heading),x:e.x-500,y:e.y-300}}));return new Array(3).fill(null).map((function(t,e){return n.filter((function(t){var n=t.angle;return n>-C/2+e*C/3&&n<-C/2+(e+1)*C/3})).length}))}(t,n),i=T(t.brain,a),r=2*Object(l.a)(i,1)[0],o=60*e,c=o*Math.sin(t.heading),s=o*Math.cos(t.heading);return Object(I.a)({},t,{x:t.x+c,y:t.y-s,heading:P(t.heading+r*e),eyeImage:a})},L=function(t,e){var n=t.objects.find((function(t){return"CREATURE"===t.type})),a=t.objects.filter((function(t){return"FOOD"!==t.type||Math.hypot(n.x-t.x,n.y-t.y)>8})),i=t.objects.length-a.length;return Object(I.a)({},t,{objects:a.map((function(n){return"CREATURE"===n.type?Object(I.a)({},_(n,e,t.objects),{tummyContent:n.tummyContent+i}):n}))})},D=function(t,e,n){return new Array(e).fill(null).reduce((function(t){return L(t,n)}),t)},N=function(){var t=Object(u.a)(s.a.mark((function t(e,n){var a,i,r;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=F({weights:e,foodAvailability:n}),90,.1,i=A()(new Array(900).fill(null),100),t.next=6,i.reduce((function(t,e){var n=e.length;return t.then((function(t){return e=function(){return D(t,n,.1)},new Promise((function(t){setTimeout((function(){return t(e())}),1)}));var e}))}),Promise.resolve(a));case 6:return r=t.sent,t.abrupt("return",r.objects.find((function(t){return"CREATURE"===t.type})).tummyContent);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),B=function(){return new Array(26).fill(null).map((function(){return 10*(Math.random()-.5)}))},z=function(t){var e=t.iterations,n=t.foodAvailability,a=t.iterationCallback;return x.a.run({generateInitialPopulation:x.a.generateInitialPopulation({generateIndividual:B,size:20}),selection:x.a.selection.roulette({minimizeFitness:!1}),succession:x.a.elitism({keepFactor:.05,minimizeFitness:!1}),reproduce:x.a.reproduce({crossover:function(t){var e=Object(l.a)(t,2),n=e[0],a=e[1];return[j()(n,a).map((function(t){var e=Object(l.a)(t,2);return.6*e[0]+.4*e[1]})),j()(n,a).map((function(t){var e=Object(l.a)(t,2);return.4*e[0]+.6*e[1]}))]},mutate:x.a.mutation.transformRandomGene((function(t){return t+Math.random()-.5})),mutationProbability:.1}),evaluatePopulation:function(t){return Promise.all(t.map((function(t){return N(t,n)})))},stopCondition:x.a.stopCondition({maxIterations:e}),iterationCallback:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];x.a.logIterationData({include:{iteration:{show:!0},avgFitness:{show:!0},maxFitness:{show:!0},logsKeys:[{key:"lastIteration"},{key:"fitness"}]}}).apply(void 0,e),a(e[0].iteration)}})},U=function(t){var e=t.iterations,n=t.foodAvailability,r=t.onFinish,o=Object(a.useState)(0),c=Object(l.a)(o,2),f=c[0],y=c[1],d=Object(a.useCallback)((function(t){y(t)}),[]);Object(a.useEffect)((function(){(function(){var t=Object(u.a)(s.a.mark((function t(){var a,i,o;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z({iterations:e,foodAvailability:n,iterationCallback:d});case 2:a=t.sent,i=a.getHighestFitnessIndividual,console.log(i()),o=i().individual,r(o);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[n,e,r,d]);var p=100*f/e;return i.a.createElement("div",{className:v.a.settingsContainer},i.a.createElement(m.a,{variant:"h3",component:"h1"},"Evolution In Progress"),i.a.createElement("div",{className:v.a.settingsInnerBox},i.a.createElement(b.a,{position:"relative",display:"inline-flex"},i.a.createElement(h.a,{variant:"static",value:p}),i.a.createElement(b.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},i.a.createElement(m.a,{variant:"caption",component:"div"},"".concat(Math.round(p),"%"))))))},K=n(5),G=function(t){var e=t.initialState,n=t.stateReducer,a=t.mapStateToRendererObjects,i=t.render,r=t.getTime,o=void 0===r?function(){return(new Date).getTime()}:r,c=t.maxDt,s=void 0===c?1/0:c,u=e,l=o(),f=!0,y=function t(){var e=o(),r=Math.min(e-l,s);l=e,u=n(u,r/1e3);var c=a(u);i(c),f||requestAnimationFrame(t)},m=function(t){(f="function"===typeof t?t(f):t)||requestAnimationFrame(y)};return m(!1),{setPause:m}},J=function(t){var e=t.x,n=t.y;return{type:K.objectTypes.CIRCLE,x:e,y:n,radius:2,contextProps:{fillStyle:"black"}}},q=function(t){var e=t.x,n=t.y,a=t.heading,i=t.eyeImage,r=t.visibilityAngle,o=t.visibilityRange,c=t.showVisibilityRange,s=void 0!==c&&c,u=[{type:K.objectTypes.CIRCLE,x:0,y:0,radius:8},J({x:-3,y:-3}),J({x:3,y:-3})],l={type:K.objectTypes.CIRCLE,x:0,y:12,radius:8},f=i.length,y=Math.PI/2,m=new Array(f).fill(null).map((function(t,e){return{type:"ARC",x:0,y:0,radius:o,startAngle:-r/2-y+e*r/f,endAngle:-r/2-y+(e+1)*r/f,contextProps:{fillStyle:"rgba(255, 255, 255, ".concat(i[e]?.3:.2,")")}}}));return{type:K.objectTypes.TRANSFORM,dx:e,dy:n,rotation:a,contextProps:{fillStyle:"white",strokeStyle:"white"},children:[].concat(u,[l],Object(O.a)(s?m:[]))}},V=function(t){var e=t.x,n=t.y;return{type:K.objectTypes.CIRCLE,x:e,y:n,radius:2,contextProps:{fillStyle:"#99f"}}},W=function(t){var e=t.x,n=t.y,a=t.text;return{type:K.objectTypes.TEXT,x:e,y:n,text:a,contextProps:{fillStyle:"white",font:"20px seif",textAlign:"left",textBaseline:"top"}}},H=function(t){var e=t.objects,n=e.map((function(t){switch(t.type){case"FOOD":return V({x:t.x,y:t.y});case"CREATURE":return q({x:t.x,y:t.y,heading:t.heading,eyeImage:t.eyeImage,visibilityAngle:t.visibilityAngle,visibilityRange:t.visibilityRange,showVisibilityRange:!0});default:throw new Error("Unexpected simulation object type")}})),a=[W({x:20,y:20,text:"Points: ".concat(e.find((function(t){return"CREATURE"===t.type})).tummyContent)})];return[].concat(Object(O.a)(n),a)},Q={ARC:function(t,e){var n=e.x,a=e.y,i=e.radius,r=e.drawMethod,o=void 0===r?K.drawMethods.FILL:r,c=e.startAngle,s=void 0===c?0:c,u=e.endAngle,l=void 0===u?2*Math.PI:u;t.beginPath(),t.moveTo(n,a),t.arc(n,a,i,s,l),function(t,e){e!==K.drawMethods.FILL&&e!==K.drawMethods.FILL_AND_STROKE||t.fill(),e!==K.drawMethods.STROKE&&e!==K.drawMethods.FILL_AND_STROKE||t.stroke()}(t,o)}},X=function(t){var e=t.weights,n=t.foodAvailability,i=Object(a.useRef)(null);return Object(a.useEffect)((function(){var t=i.current.getContext("2d"),a=Object(K.createDrawFunction)(Q),r=function(){};return function(){var i=Object(u.a)(s.a.mark((function i(){var o,c;return s.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:o=G({initialState:F({weights:e,foodAvailability:n}),stateReducer:L,mapStateToRendererObjects:H,render:function(e){return a({context:t,objects:e})},maxDt:100}),c=o.setPause,r=function(){return c(!0)};case 2:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}()(),function(){r()}}),[n,e]),{canvasRef:i}},Y=n(64),$=n.n(Y),Z=function(t){var e=t.foodAvailability,n=t.weights,a=X({foodAvailability:e,weights:n}).canvasRef;return i.a.createElement("canvas",{className:$.a.canvas,ref:a,width:1e3,height:600})},tt=function(){var t=Object(a.useState)(0),e=Object(l.a)(t,2),n=e[0],r=e[1],o=Object(a.useState)(20),c=Object(l.a)(o,2),f=c[0],y=c[1],m=Object(a.useState)(200),d=Object(l.a)(m,2),h=d[0],b=d[1],g=Object(a.useState)(null),x=Object(l.a)(g,2),w=x[0],j=x[1],E=function(){var t=Object(u.a)(s.a.mark((function t(){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r((function(t){return t+1})),console.log("START");case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=Object(a.useCallback)((function(t){j(t),r((function(t){return t+1}))}),[]);return i.a.createElement("div",{className:v.a.app},i.a.createElement("div",{className:v.a.mainContainer},{0:i.a.createElement(p,{iterations:f,foodAvailability:h,setIterations:y,setFoodAvailability:b,onStart:E}),1:i.a.createElement(U,{iterations:f,foodAvailability:h,onFinish:A}),2:i.a.createElement(Z,{foodAvailability:h,weights:w})}[n]))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(tt,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},14:function(t,e,n){t.exports={app:"App_app___B2LQ",mainContainer:"App_mainContainer__cKELM",settingsContainer:"App_settingsContainer__1RSC3",settingsInnerBox:"App_settingsInnerBox__1yA00",settingSection:"App_settingSection__yfJsU"}},64:function(t,e,n){t.exports={canvas:"Canvas_canvas__1G8xK"}},71:function(t,e,n){t.exports=n(134)},76:function(t,e,n){}},[[71,1,2]]]);
//# sourceMappingURL=main.c5d9934f.chunk.js.map